<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IRS - The International Raffle Station</title>
  <link rel="stylesheet" href="/css/general.css" />
  <link rel="stylesheet" href="/css/index.css" />
</head>

<body>
  <header>
    <h1>IRS - The International Raffle Station</h1>
    <p>Your Gateway to Celestial Rewards</p>
  </header>

  <main>
    <div class="main-content">
      <div class="welcome">
        <h2>Welcome Explorers!</h2>
        <p>
          Embark on an interstellar journey by participating in our raffles for a
          chance to win your own celestial body!
        </p>

        <h2>How It Works Beyond the Stars</h2>
        <ol>
          <li>
            Create an account or enter as a guest.
          </li>
          <li>
            Explore our raffles and choose the one you want to participate
            in.
          </li>
          <li>Enter your details and submit your entry.</li>
          <li>
            Stay tuned for the draw date to see if you're the winner!
          </li>
        </ol>

        <h2>Launch Your Galactic Adventure</h2>
        <p>
          Don't miss out on the excitement! Create an account to access
          exclusive features and participate in multiple stellar raffles.
        </p>
        <button class="action-button" onclick="window.location.href='/html/signup.html';">
          Sign Up Now!
        </button>

        <button class="action-button" onclick="window.location.href='/html/login.html';">
          Log In
        </button>

        <button class="action-button" onclick="window.location.href='/html/profile.html';">
          My Profile
        </button>
      </div>

      <div class="raffle-list">
        <h2>All Active Raffles</h2>
        <ul id="active-raffles-list"></ul>
      </div>
    </div>
  </main>

  <footer>
    <p>
      &copy; 2024 IRS - The International Raffle Station. All rights reserved.
    </p>
  </footer>

  <script>
    async function fetchRafflesAndUpdateList() {
      try {
        // Fetch data from the server to update the list of active raffles
        const response = await fetch('/all-raffles');
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        const data = await response.json();

        const raffleList = document.getElementById('active-raffles-list');
        raffleList.innerHTML = '';

        // Filter out raffles with end dates in the past
        const activeRaffles = data.filter(raffle => new Date(raffle.endDate) > new Date());

        activeRaffles.forEach(raffle => {
          const listItem = document.createElement('li');
          let participants = raffle.participants.length > 0 ? raffle.participants.join(', ') : 'None';
          listItem.innerHTML = `Name: ${raffle.name},<br>
                                Start Date: ${new Date(raffle.startDate).toLocaleString()},<br>
                                End Date: ${new Date(raffle.endDate).toLocaleString()},<br>
                                Draw Date: ${new Date(raffle.drawDate).toLocaleString()},<br>
                                Prize: ${raffle.prize},<br>
                                Participants: ${participants}`; // Assuming participants is an array
          raffleList.appendChild(listItem);
        });
      } catch (error) {
        console.error('Error fetching or processing raffles:', error);
      }
    }

    // Call fetchRafflesAndUpdateList initially
    fetchRafflesAndUpdateList();

    // Schedule periodic updates every minute
    setInterval(fetchRafflesAndUpdateList, 6000); // 60000 ms = 1 minute
  </script>

</body>

</html>

